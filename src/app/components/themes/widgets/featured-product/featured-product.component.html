<section class="section-b-space" *ngIf="product">
    <div class="container-fluid-lg">
        <div class="row g-4">
            <div class="col-lg-6">
                <div class="view-image-slider">
                    <owl-carousel-o [options]="productMainThumbSlider" #owlCar>
                        <ng-container *ngFor="let image of product?.product_galleries; index as i">
                            <ng-template carouselSlide [id]="image.id.toString()">
                                <div class="slider-image mian-slider-box">
                                    <ng-container *ngIf="videType.includes(image.mime_type); else audio">
                                        <video class="w-100" controls>
                                            <source [src]="image ? image.original_url : ''" [type]="image.mime_type">
                                        </video>
                                    </ng-container>
                                    <ng-template #audio>
                                        <ng-container *ngIf="audioType.includes(image.mime_type); else img">
                                            <div class="slider-main-img">
                                                <audio controls>
                                                    <source [src]="image ? image.original_url : ''"
                                                        [type]="image.mime_type">
                                                </audio>
                                            </div>
                                        </ng-container>
                                    </ng-template>
                                    <ng-template #img>
                                        <img [src]="image ? image.original_url : 'assets/images/product.png'"
                                            class="img-fluid" [alt]="product.name">
                                    </ng-template>
                                </div>
                            </ng-template>
                        </ng-container>
                    </owl-carousel-o>
                </div>
                <ng-container *ngIf="!product?.product_galleries?.length">
                    <div class="col-12">
                        <div class="slider-image">
                            <img [src]="product.product_thumbnail ? product.product_thumbnail.original_url : 'assets/images/product.png'"
                                class="img-fluid" [alt]="product.name">
                        </div>
                    </div>
                </ng-container>
                <div class="col-12" *ngIf="product?.product_galleries?.length">
                    <div class="bottom-slider-image left-slider no-arrow slick-top">
                        <owl-carousel-o [options]="productThumbSlider">
                            <ng-container *ngFor="let image of product?.product_galleries;">
                                <ng-template carouselSlide [id]="image.id.toString()">
                                    <div>
                                        <div class="slider-image"
                                            [class.active]="image.id.toString() == activeSlide.toString()">
                                            <img [src]="image ? image.original_url : 'assets/images/product.png'"
                                                class="img-fluid" [alt]="product.name"
                                                (click)="owlCar.to(activeSlide = image.id.toString())">
                                        </div>
                                    </div>
                                </ng-template>
                            </ng-container>
                        </owl-carousel-o>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="right-sidebar-modal">
                    <h4 class="title-name">{{ selectedVariation ? selectedVariation.name : product.name }}</h4>
                    <h4 class="price">
                        {{ (selectedVariation ? selectedVariation.sale_price : product.sale_price) | currencySymbol }}
                        <del *ngIf="selectedVariation ? selectedVariation.discount : product.discount">
                            {{ (selectedVariation ? selectedVariation.price : product.price) | currencySymbol }}
                        </del>
                        <label class="modal-label"
                            *ngIf="selectedVariation ? selectedVariation.discount : product.discount">
                            {{ (selectedVariation ? selectedVariation.discount : product.discount) }}%
                            {{ 'off' | translate }}
                        </label>
                    </h4>
                    <div class="product-rating">
                        <ngb-rating [rate]="product.rating_count"></ngb-rating>
                        <div class="fs-14 ms-2">{{ product.reviews_count }} {{ 'review' | translate }}</div>
                    </div>
                    <div class="product-detail mb-2">
                        <h4>{{ 'product_details' | translate }}:</h4>
                        <p [innerHTML]="product.short_description"></p>
                    </div>

                    <div class="selection-section mt-3" *ngIf="product.attributes?.length">
                        <app-variant-attributes [product]="product" [attributes]="product.attributes || []"
                            [owlCar]="owlCar" (selectVariation)="selectVariation($event!)">
                        </app-variant-attributes>
                    </div>
                    <div class="modal-button">
                        <div class="modal-qty" *ngIf="!product?.is_external">
                            <div class="input-group">
                                <app-button [class]="'btn qty-left-minus'" [id]="'add-to-cart'+product.id"
                                    [spinner]="false" (click)="updateQuantity(-1)">
                                    <i class="ri-subtract-fill"></i>
                                </app-button>
                                <input class="form-control input-number qty-input" type="text" name="quantity"
                                    value="{{productQty}}" readonly>
                                <app-button [class]="'btn qty-left-minus'" [id]="'qty-left-minus'+product.id"
                                    [spinner]="false" (click)="updateQuantity(1)">
                                    <i class="ri-add-line"></i>
                                </app-button>
                            </div>
                        </div>
                        <ng-container *ngIf="!product?.is_external else isExternalProduct">
                            <app-button [id]="'addcartDetailsbtnVariation'+product.id"
                                [class]="'btn theme-bg-color view-button icon text-white fw-bold btn-md'"
                                (click)="addToCart(product)"
                                *ngIf="((selectedVariation && selectedVariation.status && selectedVariation.quantity >= productQty) || (!selectedVariation && product.quantity >= productQty)) else outStock">
                                <i class="ri-shopping-cart-line me-1"></i> {{ 'Add To Cart' | translate }}
                            </app-button>
                            <ng-template #outStock>
                                <app-button [class]="'btn theme-bg-color view-button icon text-white fw-bold btn-md'"
                                    [id]="'cartDetailsbtnOs'+product.id" [spinner]="false" [disabled]="true">
                                    {{
                                    ((selectedVariation && selectedVariation.status && selectedVariation.quantity <
                                        productQty || (!selectedVariation && product.quantity < productQty))
                                        ? 'out_of_stock' : 'Add To Cart' ) | translate }} </app-button>
                            </ng-template>
                        </ng-container>
                        <ng-template #isExternalProduct>
                            <app-button [id]="'externalBtn'+product.id"
                                [class]="'btn btn-md fw-bold icon text-white theme-bg-color'"
                                (click)="externalProductLink(product.external_url)">
                                {{ (product.external_button_text ? product.external_button_text : 'buy_now') | translate
                                }}
                            </app-button>
                        </ng-template>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>