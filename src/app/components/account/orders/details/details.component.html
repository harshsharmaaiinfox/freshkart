<div class="tab-pane fade show active">
    <div class="dashboard-home">
        <!-- Hero Section with Gradient -->
        <div class="dashboard-hero">
            <div class="hero-content">
                <div class="hero-text">
                    <h1 class="hero-title">{{ 'Order Details' | translate }}</h1>
                    <p class="hero-subtitle" *ngIf="order">{{ 'Order' | translate }} #{{ order.order_number }}</p>
                </div>
                <div class="hero-actions" *ngIf="order">
                    <a href="javascript:void(0)" class="hero-btn pay-btn"
                        *ngIf="(order?.payment_status === 'FAILED' || order?.payment_status === 'PENDING') 
                        && (order?.order_status && order?.order_status?.slug != 'cancelled') && order?.payment_method != 'cod'" (click)="payModal.openModal(order)">
                        <i class="ri-refresh-line"></i>
                        <span>{{ 'Pay Now' | translate }}</span>
                    </a>
                    <a (click)="download(order.order_number)" class="hero-btn invoice-btn" download="download"
                        *ngIf="order?.invoice_url && order?.payment_status && order?.payment_status === 'COMPLETED' && isLogin">
                        <i class="ri-download-2-fill"></i>
                        <span>{{ 'Invoice' | translate }}</span>
                    </a>
                </div>
            </div>
            <div class="hero-decoration">
                <div class="decoration-circle circle-1"></div>
                <div class="decoration-circle circle-2"></div>
                <div class="decoration-circle circle-3"></div>
            </div>
        </div>

        <!-- Quick Navigation Cards -->
        <div class="quick-nav-section">
            <div class="row g-3">
                <div class="col-6 col-md-3">
                    <a class="quick-nav-card" [routerLink]="['/account/dashboard']">
                        <div class="quick-nav-icon dashboard-icon">
                            <i class="ri-home-fill"></i>
                        </div>
                        <span class="quick-nav-label">{{ 'Dashboard' | translate }}</span>
                    </a>
                </div>
                <div class="col-6 col-md-3">
                    <a class="quick-nav-card" [routerLink]="['/account/notifications']">
                        <div class="quick-nav-icon notifications-icon">
                            <i class="ri-notification-fill"></i>
                            <span class="notification-badge" *ngIf="unreadNotificationCount">{{ unreadNotificationCount
                                }}</span>
                        </div>
                        <span class="quick-nav-label">{{ 'Notifications' | translate }}</span>
                    </a>
                </div>
                <div class="col-6 col-md-3">
                    <a class="quick-nav-card" [routerLink]="['/account/order']">
                        <div class="quick-nav-icon orders-icon">
                            <i class="ri-shopping-bag-fill"></i>
                        </div>
                        <span class="quick-nav-label">{{ 'My Orders' | translate }}</span>
                    </a>
                </div>
                <div class="col-6 col-md-3">
                    <a class="quick-nav-card" [routerLink]="['/account/bank-details']">
                        <div class="quick-nav-icon bank-icon">
                            <i class="ri-bank-fill"></i>
                        </div>
                        <span class="quick-nav-label">{{ 'Bank Details' | translate }}</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Order Details Content -->
        <div class="order-details-section" *ngIf="order">
            <!-- Order Tracking Card -->
            <div class="tracking-card">
                <div class="tracking-header">
                    <i class="ri-truck-line"></i>
                    <h3>{{ 'Order Tracking' | translate }}</h3>
                </div>
                <div class="tracking-timeline">
                    <ul *ngIf="order && !order?.sub_orders?.length">
                        <ng-container *ngFor="let orderStatus of (orderStatus$ | async)?.data">
                            <li [class.active]="orderStatus?.sequence! <= order.order_status.sequence!" [ngClass]="{
                                    'd-none': (orderStatus?.sequence! >= order.order_status.sequence! 
                                    && (order.order_status && order.order_status.slug == 'cancelled')) ||
                                    orderStatus?.slug == 'cancelled' || (order.is_digital_only && (orderStatus?.slug == 'shipped' || orderStatus?.slug == 'out-for-delivery'))
                                }">
                                <div class="timeline-item">
                                    <div class="timeline-icon">
                                        <img src="assets/svg/tracking/{{orderStatus?.slug}}.svg" class="img-fluid"
                                            alt="order status tracking icon">
                                    </div>
                                    <div class="timeline-content">
                                        <span class="status-name">{{ orderStatus?.name | titleCase }}</span>
                                    </div>
                                </div>
                            </li>
                        </ng-container>
                        <li class="active cancelled-status"
                            *ngIf="order?.order_status && order?.order_status?.slug == 'cancelled'">
                            <div class="timeline-item" *ngIf="order?.order_status">
                                <div class="timeline-icon">
                                    <img src="assets/svg/tracking/{{order.order_status.slug}}.svg" class="img-fluid"
                                        alt="order status tracking icon">
                                </div>
                                <div class="timeline-content">
                                    <span class="status-name">{{ order.order_status.name.replace('_', ' ')! | titlecase
                                        }}</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Products Card -->
            <div class="products-card" *ngIf="order?.products?.length">
                <div class="card-header">
                    <i class="ri-shopping-cart-line"></i>
                    <h3>{{ 'Order Items' | translate }}</h3>
                </div>
                <div class="table-responsive">
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>{{ 'Image' | translate }}</th>
                                <th>{{ 'Name' | translate }}</th>
                                <th>{{ 'Price' | translate }}</th>
                                <th>{{ 'Quantity' | translate }}</th>
                                <th>{{ 'Subtotal' | translate }}</th>
                                <th>{{ 'Refund Status' | translate }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let product of order.products">
                                <td class="product-image">
                                    <img [src]="product?.pivot?.variation && product?.pivot?.variation?.variation_image
                                            ? product?.pivot?.variation?.variation_image?.original_url
                                            : product?.product_thumbnail
                                            ? product?.product_thumbnail?.original_url
                                            : 'assets/images/product.png'" class="img-fluid" alt="product">
                                </td>
                                <td>
                                    <div class="product-name">{{ product?.pivot?.variation ?
                                        product?.pivot?.variation?.name : product?.name }}</div>
                                </td>
                                <td>
                                    <div class="product-price">{{ product?.pivot?.single_price | currencySymbol }}</div>
                                </td>
                                <td>
                                    <div class="product-qty">{{ product?.pivot?.quantity }}</div>
                                </td>
                                <td>
                                    <div class="product-subtotal">{{ product?.pivot?.subtotal | currencySymbol }}</div>
                                </td>
                                <td>
                                    <a class="btn-refund" href="javascript:void(0)" *ngIf="product?.is_return === 1 &&
                                        order?.payment_status && order?.payment_status === 'COMPLETED' 
                                        && order.order_status && order.order_status.slug == 'delivered' && 
                                        !product?.pivot?.refund_status;
                                        else noRefund" (click)="refundModal.openModal(product, order.id)">
                                        {{ 'Refund' | translate }}
                                    </a>
                                    <ng-template #noRefund>
                                        <ng-container *ngIf="product.is_return === 0; else NonRefundable">
                                            <span class="text-muted">Non Refundable</span>
                                        </ng-container>
                                        <ng-template #NonRefundable>
                                            <div class="status-badge status-{{product?.pivot?.refund_status?.toLowerCase()}}"
                                                *ngIf="product?.pivot?.refund_status; else disabled">
                                                <span>{{ product?.pivot?.refund_status | titleCase }}</span>
                                            </div>
                                            <ng-template #disabled>
                                                <div placement="top" class="black-tooltip"
                                                    ngbTooltip="Enable after delivery">
                                                    <a class="btn-refund disabled"
                                                        *ngIf="!product?.pivot?.refund_status"> {{ 'Refund' | translate
                                                        }}</a>
                                                </div>
                                            </ng-template>
                                        </ng-template>
                                    </ng-template>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Consumer Details & Summary Row -->
            <div class="row g-4">
                <div class="col-lg-7">
                    <div class="details-card">
                        <div class="card-header">
                            <i class="ri-user-line"></i>
                            <h3>{{ 'Consumer Details' | translate }}</h3>
                        </div>
                        <div class="card-body">
                            <div class="details-grid">
                                <div class="detail-item" *ngIf="order?.billing_address">
                                    <label><i class="ri-map-pin-line"></i> {{ 'Billing Address' | translate }}</label>
                                    <div class="detail-value" *ngIf="order?.billing_address?.state">
                                        {{ order.billing_address.street }},
                                        {{ order.billing_address.city }}, {{ order.billing_address.state.name }},
                                        {{ order.billing_address.country.name }} - {{ order.billing_address.pincode
                                        }}<br>
                                        {{ 'phone' | translate }}: +{{ order.billing_address.country_code }} {{
                                        order.billing_address.phone }}
                                    </div>
                                </div>
                                <div class="detail-item" *ngIf="order?.shipping_address && !order?.is_digital_only">
                                    <label><i class="ri-truck-line"></i> {{ 'Shipping Address' | translate }}</label>
                                    <div class="detail-value" *ngIf="order?.shipping_address?.state">
                                        {{ order.shipping_address.street }},
                                        {{ order.shipping_address.city }}, {{ order.shipping_address.state.name }},
                                        {{ order.shipping_address.country.name }} - {{ order.shipping_address.pincode
                                        }}<br>
                                        {{ 'Phone' | translate }}: +{{ order.shipping_address.country_code }} {{
                                        order.shipping_address.phone }}
                                    </div>
                                </div>
                                <div class="detail-item" *ngIf="order?.delivery_description && !order?.is_digital_only">
                                    <label><i class="ri-time-line"></i> {{ 'Delivery Slot' | translate }}</label>
                                    <div class="detail-value">Standard Delivery | Approx 10 to 15 Days</div>
                                </div>
                                <div class="detail-item" *ngIf="order?.payment_method">
                                    <label><i class="ri-wallet-line"></i> {{ 'Payment Mode' | translate }}</label>
                                    <div class="detail-value">
                                        <span *ngIf="order?.payment_method === 'VastraVibe_nabu'">Pay By UPI INTENT
                                            3</span>
                                        <span *ngIf="order?.payment_method !== 'VastraVibe_nabu'">{{
                                            order.payment_method |
                                            uppercase }}</span>
                                    </div>
                                </div>
                                <div class="detail-item" *ngIf="order?.payment_method">
                                    <label><i class="ri-check-line"></i> {{ 'Payment Status' | translate }}</label>
                                    <div class="detail-value">
                                        <span class="status-badge status-{{order.payment_status?.toLowerCase()}}">{{
                                            order.payment_status | uppercase }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="summary-card">
                        <div class="card-header">
                            <i class="ri-file-list-3-line"></i>
                            <h3>{{ 'Order Summary' | translate }}</h3>
                        </div>
                        <div class="card-body">
                            <ul class="summary-list">
                                <li>
                                    <span>{{ 'Subtotal' | translate }}</span>
                                    <span class="value">{{ (order.amount ? order.amount : 0) | currencySymbol }}</span>
                                </li>
                                <li *ngIf="!order?.is_digital_only">
                                    <span>{{ 'shipping'| translate }}</span>
                                    <span class="value">{{ (order.shipping_total ? order.shipping_total : 0) |
                                        currencySymbol }}</span>
                                </li>
                                <li>
                                    <span>{{ 'tax'| translate }}</span>
                                    <span class="value">{{ (order.tax_total ? order.tax_total : 0) | currencySymbol
                                        }}</span>
                                </li>
                                <li class="discount" *ngIf="order.points_amount != 0">
                                    <span>{{ 'points'| translate }}</span>
                                    <span class="value">-{{ order.points_amount | currencySymbol }}</span>
                                </li>
                                <li class="discount" *ngIf="order.wallet_balance != 0">
                                    <span>{{ 'wallet_balance'| translate }}</span>
                                    <span class="value">-{{ order.wallet_balance | currencySymbol }}</span>
                                </li>
                                <li class="discount" *ngIf="order.coupon_total_discount != 0">
                                    <span>{{ 'discount'| translate }}</span>
                                    <span class="value">-{{ order.coupon_total_discount | currencySymbol }}</span>
                                </li>
                                <li class="total">
                                    <span>{{ 'Total'| translate }}</span>
                                    <span class="value">{{ (order.total ? order.total : 0) | currencySymbol }}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sub Orders Table -->
            <div class="products-card" *ngIf="order?.sub_orders?.length">
                <div class="card-header">
                    <i class="ri-file-list-line"></i>
                    <h3>{{ 'Sub Orders' | translate }}</h3>
                </div>
                <div class="table-responsive">
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>{{ 'Order_number' | translate }}</th>
                                <th>{{ 'Order_date' | translate }}</th>
                                <th>{{ 'Total_amount' | translate }}</th>
                                <th>{{ 'Status' | translate }}</th>
                                <th>{{ 'Action' | translate }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let subOrder of order.sub_orders">
                                <td>
                                    <div class="order-number">#{{ subOrder.order_number }}</div>
                                </td>
                                <td>
                                    <div class="order-date">{{ subOrder.created_at | date: 'dd MMM yyyy hh:mm:a' }}
                                    </div>
                                </td>
                                <td>
                                    <div class="order-amount">{{ subOrder.amount | currencySymbol }}</div>
                                </td>
                                <td>
                                    <div class="status-badge status-{{subOrder.order_status.slug}}">
                                        <span>{{ subOrder.order_status.name }}</span>
                                    </div>
                                </td>
                                <td>
                                    <a href="javascript:void(0)" class="view-btn"
                                        [routerLink]="['/account/order/details', subOrder.order_number]">
                                        <i class="ri-eye-line"></i>
                                        <span>View</span>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<app-refund-modal #refundModal></app-refund-modal>
<app-pay-modal #payModal></app-pay-modal>