<div class="tab-pane fade show active">
    <div class="dashboard-home">
        <!-- Full Width Menu Bar -->
        <div class="dashboard-menu-bar">
            <div class="menu-container">
                <a class="menu-item" [routerLinkActive]="['active']" [routerLink]="['/account/dashboard']">
                    <i class="ri-home-fill"></i>
                    <span>{{ 'Dashboard' | translate }}</span>
                </a>
                <a class="menu-item" [routerLinkActive]="['active']" [routerLink]="['/account/notifications']">
                    <i class="ri-notification-fill"></i>
                    <span>{{ 'Notifications' | translate }}</span>
                    <span class="notification-badge" *ngIf="unreadNotificationCount">{{ unreadNotificationCount
                        }}</span>
                </a>
                <a class="menu-item" [routerLinkActive]="['active']" [routerLink]="['/account/bank-details']">
                    <i class="ri-bank-fill"></i>
                    <span>{{ 'Bank Details' | translate }}</span>
                </a>
                <a class="menu-item" [routerLinkActive]="['active']" [routerLink]="['/account/order']">
                    <i class="ri-file-text-fill"></i>
                    <span>{{ 'My Orders' | translate }}</span>
                </a>

                <a class="menu-item" [routerLinkActive]="['active']" [routerLink]="['/account/refund']">
                    <i class="ri-money-rupee-circle-fill"></i>
                    <span>{{ 'Refund History' | translate }}</span>
                </a>
                <a class="menu-item" [routerLinkActive]="['active']" [routerLink]="['/account/addresses']">
                    <i class="ri-map-pin-fill"></i>
                    <span>{{ 'Saved Address' | translate }}</span>
                </a>
            </div>
        </div>

        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="header-content">
                <div class="header-text">
                    <h2 class="dashboard-title">{{ 'My Dashboard' | translate }}</h2>
                    <p class="dashboard-subtitle">{{ 'Hello' | translate }}, <strong>{{ (user$ | async)?.name! |
                            titleCase }}</strong> - {{ "Welcome" | translate}}</p>
                </div>
            </div>
        </div>

        <!-- Order Details Content -->
        <div class="dashboard-content order-details-wrapper" *ngIf="order">
            <!-- Order Header Card -->
            <div class="order-header-card">
                <div class="order-info">
                    <h2 class="order-number">{{ 'order_number' | translate }}: #{{ order.order_number }}</h2>
                </div>
                <div class="order-actions">
                    <a href="javascript:void(0)" class="btn-pay"
                        *ngIf="(order?.payment_status === 'FAILED' || order?.payment_status === 'PENDING') 
                        && (order?.order_status && order?.order_status?.slug != 'cancelled') && order?.payment_method != 'cod'"
                        (click)="payModal.openModal(order)">
                        <i class="ri-refresh-line"></i>
                        {{ 'Pay Now' | translate }}
                    </a>
                    <a (click)="download(order.order_number)" class="btn-invoice" download="download"
                        *ngIf="order?.invoice_url && order?.payment_status && order?.payment_status === 'COMPLETED' && isLogin">
                        <i class="ri-download-2-fill"></i>
                        {{ 'Invoice' | translate }}
                    </a>
                </div>
            </div>

            <!-- Tracking Card -->
            <div class="tracking-card">
                <div class="tracking-panel">
                    <ul *ngIf="order && !order?.sub_orders?.length">
                        <ng-container *ngFor="let orderStatus of (orderStatus$ | async)?.data">
                            <li [class.active]="orderStatus?.sequence! <= order.order_status.sequence!" [ngClass]="{
                                    'd-none': (orderStatus?.sequence! >= order.order_status.sequence! 
                                    && (order.order_status && order.order_status.slug == 'cancelled')) ||
                                    orderStatus?.slug == 'cancelled' || (order.is_digital_only && (orderStatus?.slug == 'shipped' || orderStatus?.slug == 'out-for-delivery'))
                                }">
                                <div class="panel-content">
                                    <div class="icon">
                                        <img src="assets/svg/tracking/{{orderStatus?.slug}}.svg" class="img-fluid"
                                            alt="order status tracking icon">
                                    </div>
                                    <div class="status">{{ orderStatus?.name | titleCase }}</div>
                                </div>
                            </li>
                        </ng-container>
                        <li class="active cancelled-box"
                            *ngIf="order?.order_status && order?.order_status?.slug == 'cancelled'">
                            <div class="panel-content" *ngIf="order?.order_status">
                                <div class="icon">
                                    <img src="assets/svg/tracking/{{order.order_status.slug}}.svg" class="img-fluid"
                                        alt="order status tracking icon">
                                </div>
                                <div class="status">{{ order.order_status.name.replace('_', ' ')! | titlecase }}</div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Products Card -->
            <div class="products-card" *ngIf="order?.products?.length">
                <div class="table-responsive">
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th>{{ 'Image' | translate }}</th>
                                <th>{{ 'Name' | translate }}</th>
                                <th>{{ 'Price' | translate }}</th>
                                <th>{{ 'Quantity' | translate }}</th>
                                <th>{{ 'Subtotal' | translate }}</th>
                                <th>{{ 'Refund Status' | translate }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let product of order.products">
                                <td class="product-image">
                                    <img [src]="product?.pivot?.variation && product?.pivot?.variation?.variation_image
                                            ? product?.pivot?.variation?.variation_image?.original_url
                                            : product?.product_thumbnail
                                            ? product?.product_thumbnail?.original_url
                                            : 'assets/images/product.png'" class="img-fluid" alt="product">
                                </td>
                                <td>
                                    <h6>{{ product?.pivot?.variation ? product?.pivot?.variation?.name : product?.name
                                        }}
                                    </h6>
                                </td>
                                <td>
                                    <h6>{{ product?.pivot?.single_price | currencySymbol }}</h6>
                                </td>
                                <td>
                                    <h6>{{ product?.pivot?.quantity }}</h6>
                                </td>
                                <td>
                                    <h6>{{ product?.pivot?.subtotal | currencySymbol }}</h6>
                                </td>
                                <td>
                                    <a class="btn-refund" href="javascript:void(0)" *ngIf="product?.is_return === 1 &&
                                        order?.payment_status && order?.payment_status === 'COMPLETED' 
                                        && order.order_status && order.order_status.slug == 'delivered' && 
                                        !product?.pivot?.refund_status;
                                        else noRefund" (click)="refundModal.openModal(product, order.id)">
                                        {{ 'Refund' | translate }}
                                    </a>
                                    <ng-template #noRefund>
                                        <ng-container *ngIf="product.is_return === 0; else NonRefundable">
                                            <span class="text-muted">Non Refundable</span>
                                        </ng-container>
                                        <ng-template #NonRefundable>
                                            <div class="status-badge status-{{product?.pivot?.refund_status?.toLowerCase()}}"
                                                *ngIf="product?.pivot?.refund_status; else disabled">
                                                <span>{{ product?.pivot?.refund_status | titleCase }}</span>
                                            </div>
                                            <ng-template #disabled>
                                                <div placement="top" class="black-tooltip"
                                                    ngbTooltip="Enable after delivery">
                                                    <a class="btn-refund disabled"
                                                        *ngIf="!product?.pivot?.refund_status"> {{ 'Refund' | translate
                                                        }}</a>
                                                </div>
                                            </ng-template>
                                        </ng-template>
                                    </ng-template>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Consumer Details & Summary Row -->
            <div class="row g-3">
                <div class="col-xxl-8 col-lg-12 col-md-7">
                    <div class="details-card">
                        <div class="card-header">
                            <h4 class="card-title">
                                <i class="ri-user-line"></i>
                                {{ 'Consumer Details' | translate }}
                            </h4>
                        </div>
                        <div class="card-body">
                            <div class="details-grid">
                                <div class="detail-item" *ngIf="order?.billing_address">
                                    <label>{{ 'Billing Address' | translate }}</label>
                                    <div class="detail-value" *ngIf="order?.billing_address?.state">
                                        {{ order.billing_address.street }},
                                        {{ order.billing_address.city }}, {{ order.billing_address.state.name }},
                                        {{ order.billing_address.country.name }} - {{ order.billing_address.pincode
                                        }}<br>
                                        {{ 'phone' | translate }}: +{{ order.billing_address.country_code }} {{
                                        order.billing_address.phone }}
                                    </div>
                                </div>
                                <div class="detail-item" *ngIf="order?.shipping_address && !order?.is_digital_only">
                                    <label>{{ 'Shipping Address' | translate }}</label>
                                    <div class="detail-value" *ngIf="order?.shipping_address?.state">
                                        {{ order.shipping_address.street }},
                                        {{ order.shipping_address.city }}, {{ order.shipping_address.state.name }},
                                        {{ order.shipping_address.country.name }} - {{ order.shipping_address.pincode
                                        }}<br>
                                        {{ 'Phone' | translate }}: +{{ order.shipping_address.country_code }} {{
                                        order.shipping_address.phone }}
                                    </div>
                                </div>
                                <div class="detail-item" *ngIf="order?.delivery_description && !order?.is_digital_only">
                                    <label>{{ 'Delivery Slot' | translate }}</label>
                                    <div class="detail-value">Standard Delivery | Approx 10 to 15 Days</div>
                                </div>
                                <div class="detail-item" *ngIf="order?.payment_method">
                                    <label>{{ 'Payment Mode' | translate }}</label>
                                    <div class="detail-value">
                                        <span *ngIf="order?.payment_method === 'VastraVibe_nabu'">Pay By UPI INTENT
                                            3</span>
                                        <span *ngIf="order?.payment_method !== 'VastraVibe_nabu'">{{
                                            order.payment_method |
                                            uppercase }}</span>
                                    </div>
                                </div>
                                <div class="detail-item" *ngIf="order?.payment_method">
                                    <label>{{ 'Payment Status' | translate }}</label>
                                    <div class="detail-value">
                                        <span class="status-badge status-{{order.payment_status?.toLowerCase()}}">{{
                                            order.payment_status | uppercase }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xxl-4 col-lg-12 col-md-5">
                    <div class="summary-card">
                        <div class="card-header">
                            <h4 class="card-title">
                                <i class="ri-file-list-3-line"></i>
                                {{ 'Summary' | translate }}
                            </h4>
                        </div>
                        <div class="card-body">
                            <ul class="summary-list">
                                <li>{{ 'Subtotal' | translate }} <span>{{ (order.amount ? order.amount : 0) |
                                        currencySymbol
                                        }}</span></li>
                                <li *ngIf="!order?.is_digital_only">{{ 'shipping'| translate }} <span>{{
                                        (order.shipping_total ? order.shipping_total : 0) | currencySymbol }}</span>
                                </li>
                                <li>{{ 'tax'| translate }} <span>{{ (order.tax_total ? order.tax_total : 0) |
                                        currencySymbol
                                        }}</span></li>
                                <li class="discount" *ngIf="order.points_amount != 0">{{ 'points'| translate }}
                                    <span>-{{ order.points_amount | currencySymbol }}</span>
                                </li>
                                <li class="discount" *ngIf="order.wallet_balance != 0">{{ 'wallet_balance'|
                                    translate }} <span>-{{ order.wallet_balance | currencySymbol }}</span></li>
                                <li class="discount" *ngIf="order.coupon_total_discount != 0">{{ 'discount'|
                                    translate }} <span>-{{ order.coupon_total_discount | currencySymbol }}</span></li>
                                <li class="total">{{ 'Total'| translate }} <span>{{ (order.total ? order.total : 0) |
                                        currencySymbol
                                        }}</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sub Orders Table -->
            <div class="products-card" *ngIf="order?.sub_orders?.length">
                <div class="table-responsive">
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th>{{ 'Order_number' | translate }}</th>
                                <th>{{ 'Order_date' | translate }}</th>
                                <th>{{ 'Total_amount' | translate }}</th>
                                <th>{{ 'Status' | translate }}</th>
                                <th>{{ 'Action' | translate }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let subOrder of order.sub_orders">
                                <td>
                                    <h6>{{ '#'+subOrder.order_number }}</h6>
                                </td>
                                <td>
                                    <h6>{{ subOrder.created_at | date: 'dd MMM yyyy hh:mm:a' }}</h6>
                                </td>
                                <td>
                                    <h6>{{ subOrder.amount | currencySymbol }}</h6>
                                </td>
                                <td>
                                    <div class="status-badge status-{{subOrder.order_status.slug}}">
                                        <span>{{ subOrder.order_status.name }}</span>
                                    </div>
                                </td>
                                <td>
                                    <a href="javascript:void(0)" class="view-btn"
                                        [routerLink]="['/account/order/details', subOrder.order_number]">
                                        <i class="ri-eye-line"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<app-refund-modal #refundModal></app-refund-modal>
<app-pay-modal #payModal></app-pay-modal>